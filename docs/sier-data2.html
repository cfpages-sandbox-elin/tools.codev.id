<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisasi Data Demografi</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Optional: Custom font for better readability */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Visualisasi Data Demografi Penduduk</h1>
            <p class="text-md text-gray-600 mt-2">Analisis Berdasarkan Kecamatan, Kelompok Usia, dan Klasifikasi Ring</p>
        </header>

        <!-- Section Ringkasan Data -->
        <section id="summary" class="mb-12">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-l-4 border-blue-600 pl-4">Ringkasan Data Utama</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Card Total Penduduk -->
                <div class="bg-white p-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    <h3 class="text-sm font-medium text-gray-500">Total Seluruh Penduduk</h3>
                    <p id="totalPenduduk" class="text-3xl font-bold text-blue-600 mt-2">0</p>
                </div>
                <!-- Card Penduduk Ring 1 -->
                <div class="bg-white p-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    <h3 class="text-sm font-medium text-gray-500">Total Penduduk Ring 1</h3>
                    <p id="totalRing1" class="text-3xl font-bold text-green-600 mt-2">0</p>
                </div>
                <!-- Card Penduduk Ring 2 -->
                <div class="bg-white p-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    <h3 class="text-sm font-medium text-gray-500">Total Penduduk Ring 2</h3>
                    <p id="totalRing2" class="text-3xl font-bold text-yellow-600 mt-2">0</p>
                </div>
                 <!-- Card Angka Ketergantungan -->
                <div class="bg-white p-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    <h3 class="text-sm font-medium text-gray-500">Angka Ketergantungan</h3>
                    <p id="dependencyRatio" class="text-3xl font-bold text-red-600 mt-2">0</p>
                    <p class="text-xs text-gray-400 mt-1">Jiwa non-produktif per 100 jiwa produktif</p>
                </div>
            </div>
        </section>

        <!-- Section Visualisasi Chart -->
        <section id="charts" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Chart 1: Populasi berdasarkan Ring -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Komposisi Penduduk Berdasarkan Ring</h3>
                <canvas id="ringChart"></canvas>
                <p class="mt-4 text-sm text-gray-600">
                    <strong>Penjelasan:</strong> Bagan donat ini memvisualisasikan perbandingan jumlah total penduduk antara wilayah yang diklasifikasikan sebagai <strong>Ring 1</strong> dan <strong>Ring 2</strong>. Ini membantu memahami sebaran populasi di kedua area tersebut secara proporsional.
                </p>
            </div>

            <!-- Chart 2: Distribusi Usia -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Distribusi Penduduk Berdasarkan Kelompok Usia</h3>
                <canvas id="ageDistributionChart"></canvas>
                <p class="mt-4 text-sm text-gray-600">
                    <strong>Penjelasan:</strong> Grafik batang ini menunjukkan distribusi total penduduk di semua wilayah berdasarkan kelompok usia. Terlihat bahwa kelompok <strong>Produktif Muda (25-39 Thn)</strong> memiliki jumlah populasi terbesar, menandakan potensi demografi yang signifikan pada kelompok usia ini.
                </p>
            </div>

            <!-- Chart 3: Produktif vs Non-Produktif -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Rasio Usia Produktif vs. Non-Produktif</h3>
                <canvas id="productiveRatioChart"></canvas>
                <p class="mt-4 text-sm text-gray-600">
                    <strong>Penjelasan:</strong> Bagan ini mengilustrasikan perbandingan antara jumlah penduduk dalam rentang <strong>usia produktif (15-64 tahun)</strong> dengan <strong>usia non-produktif (0-14 dan 65+ tahun)</strong>. Rasio ini penting untuk mengukur <strong>Angka Ketergantungan (Dependency Ratio)</strong>, yang menunjukkan beban demografis yang ditanggung oleh populasi usia kerja.
                </p>
            </div>

            <!-- Chart 4: Populasi per Kecamatan -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Total Populasi per Kecamatan</h3>
                <canvas id="kecamatanChart"></canvas>
                <p class="mt-4 text-sm text-gray-600">
                    <strong>Penjelasan:</strong> Grafik batang horizontal ini membandingkan jumlah total penduduk di setiap kecamatan. Kecamatan <strong>Waru (Sidoarjo)</strong> menunjukkan populasi tertinggi secara agregat, yang disebabkan oleh banyaknya jumlah kelurahan/desa yang termasuk dalam data ini.
                </p>
            </div>

        </section>

        <!-- Section Estimasi Sampel Survei -->
        <section id="survey-sample" class="mt-12">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-l-4 border-purple-600 pl-4">Estimasi Sampel Survei Pasar</h2>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <p class="text-gray-600 mb-4">
                    Estimasi jumlah responden yang dibutuhkan menggunakan <strong>Rumus Slovin: n = N / (1 + N * eÂ²)</strong>, berdasarkan tingkat kesalahan (margin of error) yang bisa diterima.
                </p>

                <!-- Bagian untuk Populasi Total -->
                <div class="mt-6">
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">1. Berdasarkan Populasi Total</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Card 10% -->
                        <div class="border border-orange-200 p-4 rounded-lg text-center bg-orange-50">
                            <h4 class="font-semibold text-gray-700">Margin of Error 10%</h4>
                            <p class="text-xs text-gray-500 mb-2">(Tingkat kepercayaan 90%)</p>
                            <p id="sampleSize10" class="text-3xl font-bold text-orange-600">0</p>
                        </div>
                        <!-- Card 5% -->
                        <div class="border border-purple-200 p-4 rounded-lg text-center bg-purple-50">
                            <h4 class="font-semibold text-gray-700">Margin of Error 5%</h4>
                            <p class="text-xs text-gray-500 mb-2">(Tingkat kepercayaan 95%)</p>
                            <p id="sampleSize5" class="text-3xl font-bold text-purple-700">0</p>
                        </div>
                        <!-- Card 3% -->
                        <div class="border border-blue-200 p-4 rounded-lg text-center bg-blue-50">
                            <h4 class="font-semibold text-gray-700">Margin of Error 3%</h4>
                            <p class="text-xs text-gray-500 mb-2">(Tingkat kepercayaan 97%)</p>
                            <p id="sampleSize3" class="text-3xl font-bold text-blue-700">0</p>
                        </div>
                    </div>
                </div>

                <!-- Bagian untuk Rincian per Ring -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">2. Berdasarkan Klasifikasi Ring (untuk Survei Terpisah)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Card untuk Ring 1 -->
                        <div class="border border-green-200 p-4 rounded-lg bg-green-50">
                            <h4 class="font-bold text-green-800 text-center">Sampel untuk RING 1</h4>
                            <p id="totalPopRing1" class="text-xs text-gray-500 text-center mb-3">(Total Populasi N = 0)</p>
                            <div class="flex justify-around items-center">
                                <div class="text-center"><p class="text-sm font-semibold text-gray-600">Error 10%</p><p id="sampleSizeRing1_10" class="text-2xl font-bold text-green-700">0</p></div>
                                <div class="text-center"><p class="text-sm font-semibold text-gray-600">Error 5%</p><p id="sampleSizeRing1_5" class="text-2xl font-bold text-green-700">0</p></div>
                                <div class="text-center"><p class="text-sm font-semibold text-gray-600">Error 3%</p><p id="sampleSizeRing1_3" class="text-2xl font-bold text-green-700">0</p></div>
                            </div>
                        </div>
                        <!-- Card untuk Ring 2 -->
                        <div class="border border-yellow-200 p-4 rounded-lg bg-yellow-50">
                            <h4 class="font-bold text-yellow-800 text-center">Sampel untuk RING 2</h4>
                            <p id="totalPopRing2" class="text-xs text-gray-500 text-center mb-3">(Total Populasi N = 0)</p>
                            <div class="flex justify-around items-center">
                                <div class="text-center"><p class="text-sm font-semibold text-gray-600">Error 10%</p><p id="sampleSizeRing2_10" class="text-2xl font-bold text-yellow-700">0</p></div>
                                <div class="text-center"><p class="text-sm font-semibold text-gray-600">Error 5%</p><p id="sampleSizeRing2_5" class="text-2xl font-bold text-yellow-700">0</p></div>
                                <div class="text-center"><p class="text-sm font-semibold text-gray-600">Error 3%</p><p id="sampleSizeRing2_3" class="text-2xl font-bold text-yellow-700">0</p></div>
                            </div>
                        </div>
                    </div>
                </div>

                <p class="mt-6 text-sm text-gray-500 italic">
                    <strong>Catatan:</strong> Memilih margin of error yang lebih kecil (misal: 3%) akan memberikan hasil yang lebih presisi, namun membutuhkan jumlah responden yang lebih banyak. Pilihlah sesuai dengan kebutuhan dan budget riset Anda.
                </p>
            </div>
        </section>

        <!-- Section Estimasi Distribusi Pendapatan -->
        <section id="income-estimation" class="mt-12">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-l-4 border-teal-600 pl-4">Estimasi Distribusi Pendapatan per Kelurahan</h2>
            <div class="bg-white p-6 rounded-lg shadow-md mb-4">
                <p class="text-gray-600 text-sm">
                    <strong class="text-red-600">PENTING:</strong> Tabel di bawah ini adalah sebuah <strong>model estimasi</strong>, bukan data faktual. Pendapatan diperkirakan berdasarkan asumsi demografi usia produktif dan klasifikasi Ring. Data ini bertujuan untuk memberikan gambaran umum potensi pasar di setiap kelurahan.
                </p>
            </div>
            <div class="overflow-x-auto bg-white rounded-lg shadow-md">
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">Kecamatan</th>
                            <th scope="col" class="px-6 py-3">Kelurahan</th>
                            <th scope="col" class="px-6 py-3 text-center bg-red-50">Dependent / No Income<br><span class="font-normal capitalize">(Usia 0-14 & 65+)</span></th>
                            <th scope="col" class="px-6 py-3 text-center bg-yellow-50">Low Income<br><span class="font-normal capitalize">(Estimasi)</span></th>
                            <th scope="col" class="px-6 py-3 text-center bg-green-50">Middle Income<br><span class="font-normal capitalize">(Estimasi)</span></th>
                            <th scope="col" class="px-6 py-3 text-center bg-blue-50">High Income<br><span class="font-normal capitalize">(Estimasi)</span></th>
                        </tr>
                    </thead>
                    <tbody id="incomeTableBody">
                        <!-- Data estimasi pendapatan akan dimasukkan di sini oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section Tabel Data Asli -->
        <section id="raw-data" class="mt-12">
             <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-l-4 border-blue-600 pl-4">Data Mentah</h2>
             <div class="overflow-x-auto bg-white rounded-lg shadow-md">
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">Kecamatan</th>
                            <th scope="col" class="px-6 py-3">Kelurahan / Desa</th>
                            <th scope="col" class="px-6 py-3">Total Penduduk</th>
                            <th scope="col" class="px-6 py-3">0-14 Thn</th>
                            <th scope="col" class="px-6 py-3">15-24 Thn</th>
                            <th scope="col" class="px-6 py-3">25-39 Thn</th>
                            <th scope="col" class="px-6 py-3">40-54 Thn</th>
                            <th scope="col" class="px-6 py-3">55-64 Thn</th>
                            <th scope="col" class="px-6 py-3">65+ Thn</th>
                            <th scope="col" class="px-6 py-3">Ring</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Data rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
             </div>
        </section>

    </div>

    <script>
        // DATASET
        const demographyData = [
            { kecamatan: "Rungkut", kelurahan: "Kali Rungkut", total: 23310, usia0_14: 5012, usia15_24: 3565, usia25_39: 7152, usia40_54: 4412, usia55_64: 1365, usia65_plus: 1804, ring: 1 },
            { kecamatan: "Rungkut", kelurahan: "Kedung Baruk", total: 16102, usia0_14: 3462, usia15_24: 2463, usia25_39: 4941, usia40_54: 3048, usia55_64: 943, usia65_plus: 1250, ring: 1 },
            { kecamatan: "Rungkut", kelurahan: "Penjaringan Sari", total: 19439, usia0_14: 4179, usia15_24: 2972, usia25_39: 5961, usia40_54: 3677, usia55_64: 1137, usia65_plus: 1506, ring: 1 },
            { kecamatan: "Rungkut", kelurahan: "Rungkut Kidul", total: 13503, usia0_14: 2903, usia15_24: 2064, usia25_39: 4139, usia40_54: 2553, usia55_64: 790, usia65_plus: 1046, ring: 1 },
            { kecamatan: "Rungkut", kelurahan: "Medokan Ayu", total: 29673, usia0_14: 6379, usia15_24: 4537, usia25_39: 9102, usia40_54: 5615, usia55_64: 1737, usia65_plus: 2295, ring: 2 },
            { kecamatan: "Rungkut", kelurahan: "Wonorejo", total: 19429, usia0_14: 4176, usia15_24: 2970, usia25_39: 5957, usia40_54: 3675, usia55_64: 1136, usia65_plus: 1505, ring: 2 },
            { kecamatan: "Gunung Anyar", kelurahan: "Rungkut Menanggal", total: 13357, usia0_14: 2899, usia15_24: 2083, usia25_39: 4092, usia40_54: 2563, usia55_64: 732, usia65_plus: 988, ring: 1 },
            { kecamatan: "Gunung Anyar", kelurahan: "Rungkut Tengah", total: 13572, usia0_14: 2946, usia15_24: 2116, usia25_39: 4158, usia40_54: 2604, usia55_64: 744, usia65_plus: 1004, ring: 1 },
            { kecamatan: "Gunung Anyar", kelurahan: "Gunung Anyar", total: 22936, usia0_14: 4980, usia15_24: 3577, usia25_39: 7029, usia40_54: 4402, usia55_64: 1254, usia65_plus: 1694, ring: 1 },
            { kecamatan: "Gunung Anyar", kelurahan: "Gunung Anyar Tambak", total: 11337, usia0_14: 2461, usia15_24: 1768, usia25_39: 3474, usia40_54: 2176, usia55_64: 620, usia65_plus: 838, ring: 2 },
            { kecamatan: "Tenggilis Mejoyo", kelurahan: "Kendangsari", total: 14805, usia0_14: 3139, usia15_24: 2296, usia25_39: 4606, usia40_54: 2801, usia55_64: 839, usia65_plus: 1124, ring: 1 },
            { kecamatan: "Tenggilis Mejoyo", kelurahan: "Kutisari", total: 18598, usia0_14: 3943, usia15_24: 2884, usia25_39: 5786, usia40_54: 3519, usia55_64: 1054, usia65_plus: 1412, ring: 1 },
            { kecamatan: "Tenggilis Mejoyo", kelurahan: "Panjang Jiwo", total: 13582, usia0_14: 2880, usia15_24: 2106, usia25_39: 4225, usia40_54: 2570, usia55_64: 769, usia65_plus: 1032, ring: 2 },
            { kecamatan: "Tenggilis Mejoyo", kelurahan: "Tenggilis Mejoyo", total: 18892, usia0_14: 4005, usia15_24: 2930, usia25_39: 5877, usia40_54: 3575, usia55_64: 1070, usia65_plus: 1435, ring: 1 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Berbek", total: 8614, usia0_14: 1826, usia15_24: 1294, usia25_39: 2678, usia40_54: 1638, usia55_64: 489, usia65_plus: 689, ring: 1 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Tambak Sawah", total: 12016, usia0_14: 2547, usia15_24: 1805, usia25_39: 3736, usia40_54: 2285, usia55_64: 683, usia65_plus: 962, ring: 1 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Tambak Sumur", total: 8825, usia0_14: 1871, usia15_24: 1326, usia25_39: 2744, usia40_54: 1678, usia55_64: 501, usia65_plus: 706, ring: 1 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Tropodo", total: 22028, usia0_14: 4670, usia15_24: 3310, usia25_39: 6848, usia40_54: 4188, usia55_64: 1252, usia65_plus: 1762, ring: 1 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Wadungasri", total: 11233, usia0_14: 2382, usia15_24: 1688, usia25_39: 3492, usia40_54: 2136, usia55_64: 639, usia65_plus: 898, ring: 1 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Kepuh Kiriman", total: 17519, usia0_14: 3715, usia15_24: 2632, usia25_39: 5446, usia40_54: 3331, usia55_64: 996, usia65_plus: 1401, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Pepelegi", total: 14383, usia0_14: 3051, usia15_24: 2161, usia25_39: 4471, usia40_54: 2734, usia55_64: 818, usia65_plus: 1149, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Tambak Rejo", total: 15655, usia0_14: 3320, usia15_24: 2352, usia25_39: 4867, usia40_54: 2976, usia55_64: 890, usia65_plus: 1250, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Bungurasih", total: 8589, usia0_14: 1822, usia15_24: 1291, usia25_39: 2671, usia40_54: 1634, usia55_64: 488, usia65_plus: 685, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Janti", total: 5772, usia0_14: 1224, usia15_24: 867, usia25_39: 1795, usia40_54: 1098, usia55_64: 328, usia65_plus: 461, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Kureksari", total: 14025, usia0_14: 2975, usia15_24: 2107, usia25_39: 4360, usia40_54: 2666, usia55_64: 797, usia65_plus: 1120, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Medaeng", total: 9987, usia0_14: 2118, usia15_24: 1501, usia25_39: 3105, usia40_54: 1899, usia55_64: 568, usia65_plus: 798, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Ngingas", total: 14047, usia0_14: 2979, usia15_24: 2111, usia25_39: 4367, usia40_54: 2671, usia55_64: 798, usia65_plus: 1122, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Waru", total: 8643, usia0_14: 1833, usia15_24: 1299, usia25_39: 2687, usia40_54: 1644, usia55_64: 491, usia65_plus: 691, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Wedoro", total: 14283, usia0_14: 3030, usia15_24: 2146, usia25_39: 4440, usia40_54: 2715, usia55_64: 812, usia65_plus: 1142, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Kedungrejo", total: 16711, usia0_14: 3544, usia15_24: 2511, usia25_39: 5195, usia40_54: 3177, usia55_64: 950, usia65_plus: 1335, ring: 2 },
            { kecamatan: "Waru (Sidoarjo)", kelurahan: "Tambak Oso", total: 2508, usia0_14: 532, usia15_24: 377, usia25_39: 780, usia40_54: 477, usia55_64: 142, usia65_plus: 200, ring: 2 },
        ];

        // Helper function to format numbers with dots
        function formatNumber(num) {
            return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
        }

        // --- DATA PROCESSING ---
        // 1. Total Population
        const totalPopulation = demographyData.reduce((sum, item) => sum + item.total, 0);

        // 2. Total by Ring
        const totalRing1 = demographyData.filter(d => d.ring === 1).reduce((sum, item) => sum + item.total, 0);
        const totalRing2 = demographyData.filter(d => d.ring === 2).reduce((sum, item) => sum + item.total, 0);

        // 3. Total by Age Group
        const totalsByAge = {
            '0-14 Thn': demographyData.reduce((sum, item) => sum + item.usia0_14, 0),
            '15-24 Thn': demographyData.reduce((sum, item) => sum + item.usia15_24, 0),
            '25-39 Thn': demographyData.reduce((sum, item) => sum + item.usia25_39, 0),
            '40-54 Thn': demographyData.reduce((sum, item) => sum + item.usia40_54, 0),
            '55-64 Thn': demographyData.reduce((sum, item) => sum + item.usia55_64, 0),
            '65+ Thn': demographyData.reduce((sum, item) => sum + item.usia65_plus, 0),
        };

        // 4. Total Productive vs Non-Productive
        const totalProductive = totalsByAge['15-24 Thn'] + totalsByAge['25-39 Thn'] + totalsByAge['40-54 Thn'] + totalsByAge['55-64 Thn'];
        const totalNonProductive = totalsByAge['0-14 Thn'] + totalsByAge['65+ Thn'];
        const dependencyRatio = ((totalNonProductive / totalProductive) * 100).toFixed(2);

        // 5. Total by Kecamatan
        const totalsByKecamatan = demographyData.reduce((acc, curr) => {
            if (!acc[curr.kecamatan]) {
                acc[curr.kecamatan] = 0;
            }
            acc[curr.kecamatan] += curr.total;
            return acc;
        }, {});

        // 6. Estimasi Sampel Survei (Slovin's Formula)
        const marginOfError10 = 0.10; // 10%
        const marginOfError5 = 0.05;  // 5%
        const marginOfError3 = 0.03;  // 3%

        // Rumus: n = N / (1 + N * e^2)
        const slovin = (N, e) => Math.ceil(N / (1 + N * e * e));

        // Kalkulasi untuk Populasi Total
        const sampleSize10 = slovin(totalPopulation, marginOfError10);
        const sampleSize5 = slovin(totalPopulation, marginOfError5);
        const sampleSize3 = slovin(totalPopulation, marginOfError3);

        // Kalkulasi spesifik untuk Ring 1
        const sampleSizeRing1_10 = slovin(totalRing1, marginOfError10);
        const sampleSizeRing1_5 = slovin(totalRing1, marginOfError5);
        const sampleSizeRing1_3 = slovin(totalRing1, marginOfError3);

        // Kalkulasi spesifik untuk Ring 2
        const sampleSizeRing2_10 = slovin(totalRing2, marginOfError10);
        const sampleSizeRing2_5 = slovin(totalRing2, marginOfError5);
        const sampleSizeRing2_3 = slovin(totalRing2, marginOfError3);

        // --- FUNGSI UNTUK MENGHITUNG ESTIMASI PENDAPATAN ---
        function calculateIncomeDistribution(data) {
            return data.map(row => {
                // Kelompok Dependent adalah tetap
                const dependent = row.usia0_14 + row.usia65_plus;
                
                // Asumsi awal: semua di kelompok awal produktif (15-24) adalah Low Income
                let lowIncome = row.usia15_24;
                let middleIncome = 0;
                let highIncome = 0;

                // Ambil populasi produktif utama (25-54) dan pra-pensiun (55-64)
                const productivePopulation = row.usia25_39 + row.usia40_54;
                const preRetirementPopulation = row.usia55_64;

                if (row.ring === 1) {
                    // Asumsi untuk Ring 1: Lebih banyak High Income
                    // 35% dari produktif utama -> High, 65% -> Middle
                    highIncome += Math.round(productivePopulation * 0.35);
                    middleIncome += Math.round(productivePopulation * 0.65);
                    // 20% dari pra-pensiun -> High, 80% -> Middle
                    highIncome += Math.round(preRetirementPopulation * 0.20);
                    middleIncome += Math.round(preRetirementPopulation * 0.80);
                } else { // Ring 2
                    // Asumsi untuk Ring 2: Lebih banyak Middle Income
                    // 15% dari produktif utama -> High, 85% -> Middle
                    highIncome += Math.round(productivePopulation * 0.15);
                    middleIncome += Math.round(productivePopulation * 0.85);
                    // 5% dari pra-pensiun -> High, 95% -> Middle
                    highIncome += Math.round(preRetirementPopulation * 0.05);
                    middleIncome += Math.round(preRetirementPopulation * 0.95);
                }

                return {
                    ...row, // Salin semua data asli
                    incomeDependent: dependent,
                    incomeLow: lowIncome,
                    incomeMiddle: middleIncome,
                    incomeHigh: highIncome
                };
            });
        }

        // --- FUNGSI UNTUK MERENDER TABEL PENDAPATAN ---
        function renderIncomeTable(incomeData) {
            const tableBody = document.getElementById('incomeTableBody');
            tableBody.innerHTML = ''; // Kosongkan tabel sebelum diisi

            incomeData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'bg-white border-b hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${row.kecamatan}</td>
                    <td class="px-6 py-4">${row.kelurahan}</td>
                    <td class="px-6 py-4 text-center">${formatNumber(row.incomeDependent)}</td>
                    <td class="px-6 py-4 text-center">${formatNumber(row.incomeLow)}</td>
                    <td class="px-6 py-4 text-center">${formatNumber(row.incomeMiddle)}</td>
                    <td class="px-6 py-4 text-center">${formatNumber(row.incomeHigh)}</td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // --- DOM MANIPULATION & RENDER ---
        document.addEventListener('DOMContentLoaded', () => {
            // Fill Summary Cards
            document.getElementById('totalPenduduk').innerText = formatNumber(totalPopulation);
            document.getElementById('totalRing1').innerText = formatNumber(totalRing1);
            document.getElementById('totalRing2').innerText = formatNumber(totalRing2);
            document.getElementById('dependencyRatio').innerText = dependencyRatio;
            // Fill Survey Sample Cards
            document.getElementById('sampleSize10').innerText = formatNumber(sampleSize10) + ' Responden';
            document.getElementById('sampleSize5').innerText = formatNumber(sampleSize5) + ' Responden';
            document.getElementById('sampleSize3').innerText = formatNumber(sampleSize3) + ' Responden';

            document.getElementById('totalPopRing1').innerText = `(Total Populasi N = ${formatNumber(totalRing1)})`;
            document.getElementById('sampleSizeRing1_10').innerText = formatNumber(sampleSizeRing1_10);
            document.getElementById('sampleSizeRing1_5').innerText = formatNumber(sampleSizeRing1_5);
            document.getElementById('sampleSizeRing1_3').innerText = formatNumber(sampleSizeRing1_3);

            document.getElementById('totalPopRing2').innerText = `(Total Populasi N = ${formatNumber(totalRing2)})`;
            document.getElementById('sampleSizeRing2_10').innerText = formatNumber(sampleSizeRing2_10);
            document.getElementById('sampleSizeRing2_5').innerText = formatNumber(sampleSizeRing2_5);
            document.getElementById('sampleSizeRing2_3').innerText = formatNumber(sampleSizeRing2_3);

            // Fill Data Table
            const tableBody = document.getElementById('dataTableBody');
            demographyData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'bg-white border-b hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${row.kecamatan}</td>
                    <td class="px-6 py-4">${row.kelurahan}</td>
                    <td class="px-6 py-4">${formatNumber(row.total)}</td>
                    <td class="px-6 py-4">${formatNumber(row.usia0_14)}</td>
                    <td class="px-6 py-4">${formatNumber(row.usia15_24)}</td>
                    <td class="px-6 py-4">${formatNumber(row.usia25_39)}</td>
                    <td class="px-6 py-4">${formatNumber(row.usia40_54)}</td>
                    <td class="px-6 py-4">${formatNumber(row.usia55_64)}</td>
                    <td class="px-6 py-4">${formatNumber(row.usia65_plus)}</td>
                    <td class="px-6 py-4">${row.ring}</td>
                `;
                tableBody.appendChild(tr);
            });

            const estimatedIncomeData = calculateIncomeDistribution(demographyData);
            renderIncomeTable(estimatedIncomeData);

            // --- CHART INITIALIZATION ---
            // Chart 1: Ring Chart
            new Chart(document.getElementById('ringChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Ring 1', 'Ring 2'],
                    datasets: [{
                        label: 'Total Populasi',
                        data: [totalRing1, totalRing2],
                        backgroundColor: ['#10B981', '#F59E0B'], // green-500, yellow-500
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${formatNumber(context.raw)}` } }
                    }
                }
            });

            // Chart 2: Age Distribution Chart
            new Chart(document.getElementById('ageDistributionChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(totalsByAge),
                    datasets: [{
                        label: 'Total Penduduk',
                        data: Object.values(totalsByAge),
                        backgroundColor: 'rgba(59, 130, 246, 0.7)', // blue-500 with opacity
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true, ticks: { callback: (value) => formatNumber(value) } } },
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${formatNumber(context.raw)}` } }
                    }
                }
            });

            // Chart 3: Productive Ratio Chart
            new Chart(document.getElementById('productiveRatioChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Usia Produktif (15-64 Thn)', 'Usia Non-Produktif (0-14 & 65+ Thn)'],
                    datasets: [{
                        label: 'Populasi',
                        data: [totalProductive, totalNonProductive],
                        backgroundColor: ['#2563EB', '#DC2626'], // blue-700, red-600
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${formatNumber(context.raw)}` } }
                    }
                }
            });

            // Chart 4: Kecamatan Chart (Horizontal Bar)
            new Chart(document.getElementById('kecamatanChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(totalsByKecamatan),
                    datasets: [{
                        label: 'Total Populasi',
                        data: Object.values(totalsByKecamatan),
                        backgroundColor: ['#8B5CF6', '#EC4899', '#F97316', '#14B8A6'], // violet, pink, orange, teal
                        borderColor: '#ffffff',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // This makes the bar chart horizontal
                    responsive: true,
                    scales: { x: { beginAtZero: true, ticks: { callback: (value) => formatNumber(value) } } },
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${formatNumber(context.raw)}` } }
                    }
                }
            });

        });
    </script>
</body>
</html>